<!DOCTYPE html>
<html>

<head>
<script type="text/javascript" src="jugsawirparser.js"></script>
</head>
<body>

<h1>JugsawIR Test Page</h1>

<p>
    Please type the following code in a google chrome console.
</p>

<code>
    <pre>
        const parser = get_parser();
        parser.parse('{"type":"Array", "fields":[[2,3], [1,2]]}')
    </pre>
</code>

<script>

// request_app("http://localhost:8088", "unspecified", "helloworld")
function request_app(handler, endpoint, project, appname, version="latest") {
    const url = new URL(`v1/proj/${project}/app/${appname}/ver/${version}/func`, endpoint).href
    fetch(url, {
        method: 'GET',
    })
   .then(response=>response.text()).then(ir2adt).then(handler)
}

function call(endpoint, project, appname, fname, args, kwargs, maxtime=60, created_by="unspecified", version="lastest"){
    const url = new URL(`v1/proj/${project}/app/${appname}/ver/${version}/func/${fname}`, endpoint).href
    const job_id = uuid4();
    const jobspec = {"type" : "Jugsaw.JobSpec", "fields" : [job_id, Date.now(), created_by,
        maxtime, fname, args, kwargs]};
    fetch(url, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            "ce-id":uuid4(), "ce-type":"any", "ce-source":"any",
            "ce-specversion":"1.0"
        },
        body: JSON.stringify(adt2ir(jobspec))
    })
    return job_id
}

</script>

</body>
</html>